easyblock = 'PythonBundle'

name = 'modisco-lite'
version = '2.0.7'

homepage = 'https://github.com/jmschrei/tfmodisco-lite'
description = """TF-MoDISco is a motif detection algorithm that takes in nucleotide
    sequence and the attributions from a neural network model and return motifs
    that are repeatedly enriched for attriution score across the examples.
    This tool will take in one-hot encoded sequence, the corresponding
    attribution scores, and a few other parameters, and return the motifs."""

toolchain = {'name': 'foss', 'version': '2021b'}

dependencies = [
    ('h5py', '3.6.0'),
    ('hdf5plugin', '3.2.0'),
    ('igraph', '0.9.5'),
    ('python-igraph', '0.9.8'),
    ('leidenalg', '0.8.8'),
    ('matplotlib', '3.4.3'),
    ('numba', '0.54.1'),
    ('Python', '3.9.6'),
    ('SciPy-bundle', '2021.10'),  # for numpy=1.21.3, pandas=1.3.4  and scipy=1.7.1
    ('scikit-learn', '1.0.2'),
    ('tqdm', '4.62.3'),
]

use_pip = True

# Loosen unnecessarily strict version dependencies
local_preinstallopts = "sed -i 's|numpy >= 1.21.5|numpy >= 1.21.3|g' setup.py && "
local_preinstallopts += "sed -i 's|pandas >= 1.4.3|pandas >= 1.3.4|g' setup.py && "
local_preinstallopts += "sed -i 's|leidenalg == 0.8.10|leidenalg >= 0.8.8|g' setup.py && "
local_preinstallopts += "sed -i 's|igraph == 0.9.11|igraph >= 0.9.5|g' setup.py && "
local_preinstallopts += "sed -i 's|h5py >= 3.7.0|h5py >= 3.6.0|g' setup.py && "

exts_list = [
    ('logomaker', '0.8', {
        'checksums': ['d8c7501a7d6d7961cd68e5a44e939000ebf1b0c4197a0c9198351e1d681d3f6d'],
    }),
    (name, version, {
        'modulename': 'modiscolite',
        'preinstallopts': local_preinstallopts,
        'checksums': ['937a570cd0b5cff67daddb05215f5ee4820b2f67bf8bb0e2088424a217953eef'],
    }),
]

sanity_check_paths = {
    'files': ['bin/modisco'],
    'dirs': ['lib/python%(pyshortver)s/site-packages'],
}

sanity_pip_check = True

sanity_check_commands = [
    "modisco -h",
    "modisco motifs -h",
    "modisco report -h",
]

moduleclass = 'bio'
